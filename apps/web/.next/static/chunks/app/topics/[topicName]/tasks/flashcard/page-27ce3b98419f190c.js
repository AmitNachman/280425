(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[700],{3656:(e,t,o)=>{Promise.resolve().then(o.bind(o,7711))},7279:(e,t,o)=>{"use strict";function a(e){return e.includes(" ")&&/[A-Z]/.test(e)?e:e.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ")}function r(e){return e.includes("-")&&!/[A-Z]/.test(e)?e:e.toLowerCase().replace(/\s+/g,"-")}o.d(t,{o_:()=>r,x$:()=>a})},7711:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>u});var a=o(4568),r=o(7620),n=o(8556),l=o(2942),s=o(7261),c=o.n(s),i=o(3537),d=o(9715),h=o(9731),g=o(7279);function u(){var e,t,o;let{isAuthenticated:s,isLoading:u,user:f}=(0,d.A)(),m=(0,l.useRouter)(),p=(0,l.useParams)(),x=(0,l.useSearchParams)(),w=p.topicName,y=x.get("level")||"1",[v,b]=(0,r.useState)(parseInt(y,10)||1),[k,j]=(0,r.useState)([]),[N,S]=(0,r.useState)(0),[I,A]=(0,r.useState)(!0),[T,C]=(0,r.useState)(!0),[D,E]=(0,r.useState)(null),[U,z]=(0,r.useState)(null),[W,P]=(0,r.useState)([]),[L]=(0,r.useState)(Date.now()),[R,F]=(0,r.useState)(!1),[q,O]=(0,r.useState)("normal"),[_,B]=(0,r.useState)(!1),[M,J]=(0,r.useState)(!1),[$,Q]=(0,r.useState)(!1);(0,r.useEffect)(()=>{s&&!u&&(async()=>{try{C(!0);let e=(0,i.c4)();if(!e)throw Error("Authentication required");try{let t=e.split(".");if(3===t.length){let e=JSON.parse(atob(t[1]));console.log("Token payload for debugging:",{id:e.id,userId:e.userId,email:e.email})}}catch(e){console.error("Error parsing token for debug:",e)}let t=(0,g.x$)(w);console.log('Fetching user level for topic: "'.concat(t,'"')),console.log("Auth token for debug (first 10 chars): ".concat(e.substring(0,10),"..."));let o="/api/user/level?topicName=".concat(encodeURIComponent(t));console.log("Making request to: ".concat(o));let a=await fetch(o,{headers:{Authorization:"Bearer ".concat(e)}});if(console.log("Level API response status: ".concat(a.status)),a.ok){let e=await a.json();console.log("Level API response data:",e);let o=e.level||1;if(console.log("User's current level for topic \"".concat(t,'": ').concat(o)),b(o),y&&parseInt(y,10)!==o){console.log("Redirecting user from level ".concat(y," to their current level ").concat(o));let e=(0,g.o_)(w);m.replace("/topics/".concat(e,"/tasks/flashcard?level=").concat(o))}}else{console.warn("Failed to fetch user level, using provided level:",y);let e=await a.text();console.error("Error response:",e)}}catch(e){console.error("Error fetching user level:",e)}finally{C(!1)}})()},[s,u,w,y,m]),(0,r.useEffect)(()=>{if(!s||u||T)return;let e=()=>Math.floor(3*Math.random())+5;(async()=>{try{A(!0),E(null);let t=(0,i.c4)();if(!t)throw Error("Authentication required");try{let e=t.split(".");if(3===e.length){let t=JSON.parse(atob(e[1]));console.log("Token payload in loadFlashcards:",{id:t.id,userId:t.userId,email:t.email})}}catch(e){console.error("Error parsing token for debug:",e)}let o=(0,g.x$)(w);if(console.log('Loading flashcards for topic: "'.concat(o,'", user level: ').concat(v)),!U)try{let e=await fetch("/api/tasks",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({TopicName:o,Level:v,TaskType:"flashcard",StartDate:new Date().toISOString()})});if(console.log("Task creation response status: ".concat(e.status)),e.ok){let t=await e.json();z(t.TaskId),console.log("Task created successfully with ID:",t.TaskId)}else{console.warn("Warning: Task creation failed, using temporary task ID");let e="client_".concat((0,h.A)());z(e)}}catch(t){console.error("Task creation error:",t);let e="client_".concat((0,h.A)());z(e)}let a=[];try{let e="/api/user-tasks?topicName=".concat(encodeURIComponent(o));console.log("Making request to: ".concat(e));let r=await fetch(e,{headers:{Authorization:"Bearer ".concat(t)}});if(console.log("User tasks API response status: ".concat(r.status)),r.ok){let e=await r.json();console.log("Retrieved ".concat(e.length," completed tasks for topic")),e.length>0&&console.log("Sample task data:",e[0]);let o=e.filter(e=>e.CompletionDate&&parseInt(e.Level)<v);if(o.length>0)for(let e of(console.log("Found ".concat(o.length," completed tasks from previous levels")),o))try{let o=await fetch("/api/words-in-task?taskId=".concat(e.TaskId),{headers:{Authorization:"Bearer ".concat(t)}});if(o.ok){let t=await o.json();if(t.data&&Array.isArray(t.data)){let o=t.data.map(e=>e.WordId);a=[...a,...o],console.log("Added ".concat(o.length," words from task ").concat(e.TaskId," at level ").concat(e.Level))}}}catch(t){console.error("Error fetching words for task ".concat(e.TaskId,":"),t)}}else{console.warn("Failed to fetch completed tasks");let e=await r.text();console.error("Error response:",e)}}catch(e){console.error("Error fetching completed tasks:",e)}a=[...new Set(a)],console.log("Total unique words from previous levels: ".concat(a.length));let r=String(v);if(("number"==typeof v||"string"==typeof v)&&/^\d+$/.test(String(v))){switch("number"==typeof v?v:parseInt(String(v),10)){case 1:r="beginner";break;case 2:r="intermediate";break;default:r="advanced"}console.log('Mapped level parameter "'.concat(v,'" to EnglishLevel value: "').concat(r,'"'))}let n=e();console.log("Using randomLimit=".concat(n," to get a random subset of flashcards"));try{let e="/api/words?topic=".concat(encodeURIComponent(o),"&level=").concat(r,"&filterLearned=true&randomLimit=").concat(n);console.log("Making request to: ".concat(e));let l=await fetch(e,{headers:{Authorization:"Bearer ".concat(t)}});if(console.log("Words API response status: ".concat(l.status)),l.ok){let e=await l.json();if(console.log("Words API returned ".concat(e.length," words")),Array.isArray(e)&&e.length>0){let l=e;if(a.length>0&&(l=e.filter(e=>!a.includes(e.WordId)),console.log("Filtered out ".concat(e.length-l.length," words from previous levels"))),l.length<3&&a.length>0){console.log("Too few words remain after filtering (".concat(l.length,"), fetching more words"));let e=await fetch("/api/words?topic=".concat(encodeURIComponent(o),"&level=").concat(r,"&filterLearned=true&randomLimit=").concat(n+5),{headers:{Authorization:"Bearer ".concat(t)}});if(e.ok){let t=await e.json();if(Array.isArray(t)&&t.length>0){let e=t.filter(e=>!a.includes(e.WordId)),o=new Set(l.map(e=>e.WordId)),r=e.filter(e=>!o.has(e.WordId));l=[...l,...r],console.log("Added ".concat(r.length," additional words, total now: ").concat(l.length))}}}l.length<3&&(console.log("Still too few words (".concat(l.length,"), adding some from previous levels")),l=e);let s=l.map(e=>({...e,TopicName:o,StartDate:new Date().toISOString()}));j(s),console.log("Successfully loaded ".concat(s.length," filtered flashcards"))}else{console.log("No filtered cards found, trying without filtering");let e=await fetch("/api/words?topic=".concat(encodeURIComponent(o),"&level=").concat(r,"&filterLearned=false&randomLimit=").concat(n),{headers:{Authorization:"Bearer ".concat(t)}});if(e.ok){let t=await e.json();if(Array.isArray(t)&&t.length>0){let e=t;a.length>0&&(e=t.filter(e=>!a.includes(e.WordId)),console.log("Filtered out ".concat(t.length-e.length," words from previous levels"))),e.length<3&&(console.log("Too few words remain after filtering (".concat(e.length,"), using original set")),e=t);let r=e.map(e=>({...e,TopicName:o,StartDate:new Date().toISOString()}));j(r),console.log("Successfully loaded ".concat(r.length," fallback flashcards"))}else throw Error("No flashcards found for this topic")}else throw Error("Failed to fetch flashcards")}}else throw Error("Failed to fetch flashcards")}catch(e){throw console.error("Error fetching flashcards:",e),e}}catch(e){console.error("Error in flashcard loading process:",e),E(e instanceof Error?e.message:"Failed to load flashcards"),j([])}finally{A(!1)}})()},[s,u,w,v,T]),(0,r.useEffect)(()=>{let e=async()=>{if(k.length>0&&U)try{if(U.startsWith("client_"))return void console.log("Using temporary task ID ".concat(U,", skipping server update"));let e=(0,i.c4)();if(!e)return void console.error("No authentication token available");let t=k.map(e=>e.WordId);console.log("Saving ".concat(t.length," flashcard words to task ").concat(U));try{let o=await fetch("/api/words-in-task",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({taskId:U,wordIds:t})});console.log("Words-in-task API response status: ".concat(o.status)),o.ok?console.log("Successfully saved all flashcard words to task"):console.error("Failed to save flashcard words to task")}catch(e){console.error("API error when saving words to task:",e)}}catch(e){console.error("Error in saveAllWordsToTask:",e)}};U&&k.length>0&&e()},[k,U]),(0,r.useEffect)(()=>{k.length>0&&W.length>=k.length?(console.log("All words have been reviewed! Setting allWordsReviewed to true"),J(!0)):(console.log("Words reviewed: ".concat(W.length,"/").concat(k.length," - Setting allWordsReviewed to false")),J(!1))},[W,k]);let V=(0,r.useCallback)(()=>{let e=k[N];return!!e&&W.includes(e.WordId)},[N,k,W]),Z=(0,r.useCallback)(()=>{let e=k[N];if(!e)return;let t=e.WordId;!W.includes(t)&&(console.log("Adding word ".concat(t," to reviewedWords")),P(e=>{let o=[...e,t];return console.log("Updated reviewedWords:",o),o}),N<k.length-1&&setTimeout(()=>{S(e=>e+1),F(!1)},300))},[N,k,W]),G=async()=>{try{if(console.group("Starting Quiz Flow"),W.length<k.length){console.warn("Not all words reviewed"),alert("נא לעבור על כל המילים לפני המעבר למבחן"),console.groupEnd();return}let e=Math.floor((Date.now()-L)/1e3);console.log("Task duration: ".concat(e," seconds (").concat(Math.floor(e/60)," minutes)"));let t=(0,i.c4)();if(!t)throw console.error("No authentication token available"),Error("Authentication required");if(U&&!U.startsWith("client_"))try{let o=await fetch("/api/tasks",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({taskId:U,TaskScore:100,DurationTask:e,CompletionDate:new Date().toISOString()})});console.log("Task completion API response status: ".concat(o.status)),o.ok?console.log("Successfully completed flashcard task"):console.error("API error when completing flashcard task:",await o.text())}catch(e){console.error("Error calling task completion API:",e)}else console.log("Using temporary task ID, skipping flashcard task completion");let o=null;try{let e=(0,g.x$)(w);console.log('Creating quiz task with formatted topic name: "'.concat(e,'"'));let a=await fetch("/api/tasks",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({TopicName:e,Level:v,TaskType:"quiz",StartDate:new Date().toISOString()})});if(console.log("Quiz task creation API response status: ".concat(a.status)),a.ok){if(o=(await a.json()).TaskId,console.log("Quiz task created successfully with ID:",o),W.length>0)try{let e=await fetch("/api/words-in-task",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({taskId:o,wordIds:W})});console.log("Add words to quiz task API response status: ".concat(e.status)),e.ok?console.log("Successfully added ".concat(W.length," words to quiz task")):console.warn("Failed to add words to quiz task")}catch(e){console.error("Error adding words to quiz task:",e)}}else console.error("Failed to create quiz task:",await a.text()),o="client_".concat((0,h.A)())}catch(e){console.error("Error creating quiz task:",e),o="client_".concat((0,h.A)())}let a=new URLSearchParams({level:v.toString()});o&&a.append("taskId",o);let r="/topics/".concat(w,"/tasks/quiz?").concat(a.toString());console.log("Navigating to quiz URL: ".concat(r)),m.push(r)}catch(e){console.error("Error starting quiz:",e),E("אירעה שגיאה במעבר למבחן. אנא נסו שנית.")}finally{console.groupEnd()}},H=(0,r.useCallback)(()=>{var e;let t=null==(e=k[N])?void 0:e.Word;if(!t)return;let o=new SpeechSynthesisUtterance(t);o.rate="slow"===q?.7:1,o.lang="en-US",window.speechSynthesis.speak(o)},[N,k,q]),K="".concat(w.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")," - level ").concat(v);return(console.log("Rendering FlashcardTask. allWordsReviewed:",M),console.log("Reviewed ".concat(W.length,"/").concat(k.length," words")),u||I||T)?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 via-orange-50 to-red-50 p-6 flex justify-center items-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"inline-block w-16 h-16 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,a.jsx)("p",{className:"text-xl font-medium text-gray-700",children:"טוען כרטיסיות..."})]})}):D?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 via-orange-50 to-red-50 p-6 flex justify-center items-center",children:(0,a.jsxs)("div",{className:"max-w-md w-full bg-white p-8 rounded-2xl shadow-xl text-center",children:[(0,a.jsx)("div",{className:"text-red-500 text-5xl mb-4",children:"❌"}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:D}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"לא ניתן לטעון את הכרטיסיות כרגע. נא לנסות שוב מאוחר יותר."}),(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-orange-500 text-white rounded-xl hover:bg-orange-600 transition-all duration-300",children:"נסה שוב"}),(0,a.jsx)(c(),{href:"#",className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-all duration-300",children:"חזרה לנושאים"})]})]})}):0===k.length?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 via-orange-50 to-red-50 p-6 flex justify-center items-center",children:(0,a.jsxs)("div",{className:"max-w-md w-full bg-white p-8 rounded-2xl shadow-xl text-center",children:[(0,a.jsx)("div",{className:"text-orange-500 text-5xl mb-4",children:"\uD83D\uDCDA"}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"אין מילים זמינות"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"אין מילים זמינות לנושא זה ברמה הנוכחית."}),(0,a.jsx)(c(),{href:"#",className:"px-6 py-3 bg-orange-500 text-white rounded-xl hover:bg-orange-600 transition-all duration-300 inline-block",children:"חזרה לנושאים"})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 via-orange-50 to-red-50 p-6 relative",dir:"rtl",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-center text-gray-800 mb-6 mt-2",children:K}),(0,a.jsx)("main",{className:"max-w-4xl mx-auto mt-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-500",children:["כרטיסיה ",N+1," מתוך ",k.length]}),(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-500",children:["נסקרו: ",W.length," מתוך ",k.length]})]}),(0,a.jsxs)("div",{className:"relative h-72 bg-gradient-to-br from-orange-50 to-yellow-50 rounded-xl flex flex-col justify-center items-center mb-8 cursor-pointer transform hover:scale-[1.02] transition-all duration-300 shadow-md",onClick:()=>F(!R),children:[(0,a.jsx)("h2",{className:"text-5xl font-bold bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent text-center px-4",children:R?null==(e=k[N])?void 0:e.Translation:null==(t=k[N])?void 0:t.Word}),!R&&(null==(o=k[N])?void 0:o.ExampleUsage)&&(0,a.jsx)("p",{className:"text-gray-600 text-xl italic mt-6 px-12 text-center",children:k[N].ExampleUsage})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center gap-6 mb-8",children:[(0,a.jsx)("button",{onClick:()=>{N>0&&(S(e=>e-1),F(!1))},className:"px-8 py-3 bg-orange-500 text-white rounded-xl hover:bg-orange-600 transition-all duration-300 transform hover:-translate-y-1 disabled:opacity-50 disabled:hover:transform-none",disabled:0===N,children:"הקודם"}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("button",{onClick:H,className:"w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 hover:bg-orange-200 transition-colors",title:"השמע הגייה",children:(0,a.jsx)(n.pPd,{size:24})}),(0,a.jsxs)("select",{value:q,onChange:e=>O(e.target.value),className:"border-2 border-orange-200 text-gray-700 rounded-xl px-4 py-2 focus:outline-none focus:border-orange-400",children:[(0,a.jsx)("option",{value:"normal",children:"מהירות רגילה"}),(0,a.jsx)("option",{value:"slow",children:"מהירות איטית"})]})]}),(0,a.jsx)("button",{onClick:()=>{N<k.length-1&&(S(e=>e+1),F(!1))},className:"px-8 py-3 bg-orange-500 text-white rounded-xl hover:bg-orange-600 transition-all duration-300 transform hover:-translate-y-1 disabled:opacity-50 disabled:hover:transform-none",disabled:N===k.length-1,children:"הבא"})]}),(0,a.jsxs)("div",{className:"flex justify-center gap-4",children:[(0,a.jsx)("button",{onClick:Z,className:"px-8 py-3 ".concat(V()?"bg-gray-400 hover:bg-gray-500":"bg-green-500 hover:bg-green-600"," \n    text-white rounded-xl transition-all duration-300 transform hover:-translate-y-1 shadow-md hover:shadow-lg"),disabled:V(),children:V()?"✓ מילה סומנה כנלמדה":"סמן מילה כמילה שלמדתי ✓"}),(0,a.jsx)("button",{onClick:()=>B(!0),className:"px-8 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-all duration-300 transform hover:-translate-y-1 shadow-md hover:shadow-lg",children:"צפה במילים שנסקרו \uD83D\uDCDA"})]}),(M||W.length>=k.length)&&(0,a.jsx)("div",{className:"flex justify-center mt-8",children:(0,a.jsx)("button",{onClick:G,className:"px-8 py-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-all duration-300 transform hover:-translate-y-1 shadow-md hover:shadow-lg text-lg",children:"סיימתי ללמוד - התחל מבחן! \uD83C\uDFAF"})})]})}),_&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full max-h-[80vh] overflow-y-auto",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"מילים שנסקרו \uD83C\uDF1F"}),W.length>0?(0,a.jsx)("ul",{className:"space-y-4",children:W.map(e=>{let t=k.find(t=>t.WordId===e);return t&&(0,a.jsx)("li",{className:"flex justify-between items-center p-3 bg-orange-50 rounded-xl",children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"font-semibold text-gray-700",children:t.Word}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:t.Translation})]})},e)})}):(0,a.jsx)("p",{className:"text-gray-500 text-center py-4",children:"אין עדיין מילים שנסקרו."}),(0,a.jsx)("button",{onClick:()=>B(!1),className:"mt-6 w-full py-3 bg-orange-500 text-white rounded-xl hover:bg-orange-600 transition-all duration-300 transform hover:-translate-y-1",children:"סגור"})]})})]})}},9731:(e,t,o)=>{"use strict";let a;o.d(t,{A:()=>s});let r={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},n=new Uint8Array(16),l=[];for(let e=0;e<256;++e)l.push((e+256).toString(16).slice(1));let s=function(e,t,o){if(r.randomUUID&&!t&&!e)return r.randomUUID();let s=(e=e||{}).random??e.rng?.()??function(){if(!a){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");a=crypto.getRandomValues.bind(crypto)}return a(n)}();if(s.length<16)throw Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){if((o=o||0)<0||o+16>t.length)throw RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[o+e]=s[e];return t}return function(e,t=0){return(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase()}(s)}}},e=>{var t=t=>e(e.s=t);e.O(0,[473,845,261,47,821,587,315,358],()=>t(3656)),_N_E=e.O()}]);