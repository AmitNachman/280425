(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[493],{7279:(e,t,s)=>{"use strict";function r(e){return e.includes(" ")&&/[A-Z]/.test(e)?e:e.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ")}function a(e){return e.includes("-")&&!/[A-Z]/.test(e)?e:e.toLowerCase().replace(/\s+/g,"-")}s.d(t,{o_:()=>a,x$:()=>r})},7866:(e,t,s)=>{Promise.resolve().then(s.bind(s,8169))},8169:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var r=s(4568),a=s(7620),o=s(2942),n=s(7261),l=s.n(n),c=s(8556),i=s(3537),d=s(9715),x=s(7279);function m(){var e;let{isAuthenticated:t,isLoading:s,user:n}=(0,d.A)(),m=(0,o.useRouter)(),h=(0,o.useParams)(),g=(0,o.useSearchParams)(),u=null==h?void 0:h.topicName,p=(null==g?void 0:g.get("level"))||"1",f=null==g?void 0:g.get("taskId"),[w,b]=(0,a.useState)(0),[N,j]=(0,a.useState)(""),[v,y]=(0,a.useState)(0),[k,A]=(0,a.useState)(0),[S,C]=(0,a.useState)(0),[z,E]=(0,a.useState)(!0),[I,D]=(0,a.useState)(!1),[q,T]=(0,a.useState)([]),[_,L]=(0,a.useState)([]),[M,R]=(0,a.useState)(!0),[U,B]=(0,a.useState)(null),[F,P]=(0,a.useState)([]),[Q,G]=(0,a.useState)([]);(0,a.useEffect)(()=>{s||t||m.push("/login")},[t,s,m]);let O="".concat(u.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")," Quiz - Level ").concat(p);(0,a.useEffect)(()=>{(async()=>{try{R(!0),B(null),console.group("Generating Quiz Questions"),console.log("Original topicName from URL:",u);let e=(0,x.x$)(u);console.log("Formatted topic names - URL:",u,"DB:",e);let t=(0,i.c4)();if(!t)throw Error("Authentication token missing");let s=[];if(f)try{console.log("Attempting to fetch words associated with flashcard task ".concat(f));let e=await fetch("/api/words-in-task?taskId=".concat(encodeURIComponent(f)),{headers:{Authorization:"Bearer ".concat(t)}});if(e.ok){let t=await e.json();t.success&&Array.isArray(t.data)?(s=t.data,console.log("Retrieved ".concat(s.length," words from task ").concat(f))):console.warn("Task words endpoint returned success, but no data array")}else console.warn("Could not fetch task words: ".concat(e.status))}catch(e){console.error("Error fetching task words:",e)}if(0===s.length){console.log("No task words found, fetching from topic instead");let r=await fetch("/api/words?topic=".concat(encodeURIComponent(e)),{headers:{Authorization:"Bearer ".concat(t)}});if(r.ok){let e=await r.json();Array.isArray(e)&&e.length>0&&(console.log("Retrieved ".concat(e.length," words using DB format topic name")),s=e)}if(0===s.length){console.log("No words found with DB format, trying URL format");let e=await fetch("/api/words?topic=".concat(encodeURIComponent(u)),{headers:{Authorization:"Bearer ".concat(t)}});if(e.ok){let t=await e.json();Array.isArray(t)&&t.length>0&&(console.log("Retrieved ".concat(t.length," words using URL format topic name")),s=t)}}}if(0===s.length)throw Error("No words found for this topic. Please complete flashcard learning first.");let r=s.filter(e=>e&&e.Word&&e.Translation&&(e.WordId||e.wordId));if(0===r.length)throw Error("No valid words found with required fields.");console.log("".concat(r.length," valid words available for quiz"));let a=r.map(t=>({id:t.WordId||t.wordId,word:t.Word,correctAnswer:t.Translation,topicName:t.TopicName||t.topicName||e})),o=a.map(e=>{let t=W(e.correctAnswer,a),s=[e.correctAnswer,...t].sort(()=>Math.random()-.5);return console.log('Generated options for word "'.concat(e.word,'":'),s),{id:e.id,word:e.word,correctAnswer:e.correctAnswer,options:s}}).sort(()=>Math.random()-.5);console.log("Generated ".concat(o.length," quiz questions")),console.log("Final quiz questions:",o.map(e=>({word:e.word,correctAnswer:e.correctAnswer,optionsCount:e.options.length,options:e.options}))),P(o),console.groupEnd()}catch(e){console.error("Error generating quiz questions:",e),B(e instanceof Error?e.message:"Failed to load quiz"),console.groupEnd()}finally{R(!1)}})()},[u,p,f]);let W=(e,t)=>{let s=[...t.filter(t=>t.correctAnswer!==e)].sort(()=>Math.random()-.5).slice(0,3).map(e=>e.correctAnswer);for(;s.length<3;)s.push("אפשרות ".concat(s.length+1));return console.log("Generated incorrect options:",s),s};(0,a.useEffect)(()=>{let e;return z&&F.length>0&&(e=setInterval(()=>C(e=>e+1),1e3)),()=>clearInterval(e)},[z,F]);let J=e=>{let t=Math.floor(e/60);return"".concat(t,":").concat((e%60).toString().padStart(2,"0"))},Z=(e,t)=>{let s;return 20+Math.max(0,5-Math.floor(e/2))+Math.min(5,t)},$=e=>{j(e)},H=async()=>{try{if(console.group("Completing Quiz Task"),console.log("Current taskId:",f),console.log("Current score:",v),console.log("Time spent:",S,"seconds"),!f){console.warn("No taskId available, cannot complete task"),console.groupEnd();return}if(f.startsWith("client_")){console.log("Using temporary task ID ".concat(f,", skipping server update")),console.groupEnd();return}let e=(0,i.c4)();if(!e){console.error("No authentication token available"),console.groupEnd();return}let t=await fetch("/api/tasks",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({taskId:f,TaskScore:v,DurationTask:S,CompletionDate:new Date().toISOString()})});if(t.ok){let e=await t.json();console.log("Successfully completed quiz task:",e)}else{let e=await t.text();console.error("Failed to complete quiz task (".concat(t.status,"):"),e)}console.groupEnd()}catch(e){console.error("Error completing quiz task:",e),console.groupEnd()}};return s||M?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 via-orange-50 to-red-50 p-6 flex justify-center items-center",children:(0,r.jsxs)("div",{className:"bg-white p-8 rounded-2xl shadow-lg text-center",children:[(0,r.jsx)("div",{className:"inline-block w-16 h-16 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,r.jsx)("p",{className:"text-xl font-medium text-gray-700",children:"Loading Quiz..."})]})}):U?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-6 flex justify-center items-center",children:(0,r.jsxs)("div",{className:"max-w-md w-full bg-white p-8 rounded-2xl shadow-xl text-center",children:[(0,r.jsx)("div",{className:"text-red-500 text-5xl mb-4",children:"❌"}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:U}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Please complete the flashcard exercise first to learn some words."}),(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,r.jsx)(l(),{href:"/topics/".concat(u,"/tasks/flashcard?level=").concat(p),className:"px-6 py-3 bg-orange-500 text-white rounded-xl hover:bg-orange-600 transition-all duration-300",children:"Go to Flashcards"}),(0,r.jsx)(l(),{href:"#",className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-all duration-300",children:"Back to Topics"})]})]})}):0===F.length?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-6 flex justify-center items-center",children:(0,r.jsxs)("div",{className:"max-w-md w-full bg-white p-8 rounded-2xl shadow-xl text-center",children:[(0,r.jsx)("div",{className:"text-orange-500 text-5xl mb-4",children:"\uD83D\uDCDA"}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"No Quiz Questions Available"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Please complete the flashcard exercise first to learn some words."}),(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,r.jsx)(l(),{href:"/topics/".concat(u,"/tasks/flashcard?level=").concat(p),className:"px-6 py-3 bg-orange-500 text-white rounded-xl hover:bg-orange-600 transition-all duration-300",children:"Go to Flashcards"}),(0,r.jsx)(l(),{href:"#",className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-all duration-300",children:"Back to Topics"})]})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 via-orange-50 to-red-50 p-6 relative",dir:"rtl",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-center text-gray-800 mb-6 mt-2",children:O}),(0,r.jsx)("div",{className:"max-w-4xl mx-auto bg-white rounded-2xl p-6 shadow-lg mb-6",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"text-center transform hover:scale-110 transition-all duration-300",children:[(0,r.jsx)(c.gt3,{className:"text-yellow-500 text-3xl mb-2 mx-auto"}),(0,r.jsx)("div",{className:"text-3xl font-bold text-orange-500 mb-1",children:v}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"ניקוד"})]}),(0,r.jsxs)("div",{className:"text-center transform hover:scale-110 transition-all duration-300",children:[(0,r.jsx)(c.SBv,{className:"text-orange-500 text-3xl mb-2 mx-auto"}),(0,r.jsx)("div",{className:"text-3xl font-bold text-orange-500 mb-1",children:k}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"רצף"})]}),(0,r.jsxs)("div",{className:"text-center transform hover:scale-110 transition-all duration-300",children:[(0,r.jsx)(c.rat,{className:"text-blue-500 text-3xl mb-2 mx-auto"}),(0,r.jsx)("div",{className:"text-3xl font-bold text-orange-500 mb-1",children:J(S)}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"זמן"})]})]})}),(0,r.jsxs)("main",{className:"max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-8",children:[(0,r.jsxs)("div",{className:"bg-orange-50 p-4 rounded-xl mb-6 flex items-center justify-between",children:[(0,r.jsx)("div",{children:(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-700",children:"בחן את עצמך על המילים שלמדת"})}),(0,r.jsxs)("div",{className:"text-orange-600 font-semibold",children:[F.length," שאלות"]})]}),(0,r.jsxs)("h2",{className:"text-3xl font-bold bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent mb-6",children:["שאלה ",w+1," מתוך ",F.length]}),(0,r.jsxs)("p",{className:"text-xl text-gray-700 mb-8",children:["בחר את התרגום הנכון למילה: ",(0,r.jsx)("span",{className:"font-bold text-2xl text-orange-600",children:F[w].word})]}),(0,r.jsx)("div",{className:"w-full max-w-3xl mx-auto",children:(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:null==(e=F[w])?void 0:e.options.map((e,t)=>(0,r.jsx)("button",{onClick:()=>$(e),className:"p-6 rounded-xl text-lg font-semibold transition-all duration-300 ".concat(N===e?"bg-gradient-to-r from-orange-500 to-red-500 text-white transform scale-105":"bg-white text-gray-700 border-2 border-orange-200 hover:border-orange-400 hover:scale-105"),children:e},t))})}),(0,r.jsx)("button",{onClick:()=>{if(F&&0!==F.length&&!(w>=F.length)){if(N===F[w].correctAnswer){let e=k+1;A(e);let t=Z(S/(w+1),e);y(e=>e+t),T(e=>[...e,{word:F[w].word,translation:F[w].correctAnswer}])}else A(0),L(e=>[...e,{word:F[w].word,translation:F[w].correctAnswer,userAnswer:N}]);w<F.length-1?(b(e=>e+1),j("")):(E(!1),y(e=>Math.min(200,e+Math.max(0,30-Math.floor(S/20))+20*(k===F.length))),H(),D(!0))}},disabled:!N,className:"mt-8 px-8 py-4 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-xl text-lg font-semibold hover:from-orange-600 hover:to-red-600 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed w-full md:w-auto",children:"שלח תשובה"})]}),I&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white p-8 rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent mb-6",children:"תוצאות המבחן! \uD83C\uDF89"}),(0,r.jsxs)("div",{className:"bg-orange-50 rounded-xl p-6 mb-8",children:[(0,r.jsxs)("p",{className:"text-2xl text-gray-800 font-semibold mb-2",children:["הניקוד שלך: ",(0,r.jsx)("span",{className:"text-orange-600",children:v})," נקודות"]}),(0,r.jsxs)("p",{className:"text-xl text-gray-700 mb-1",children:["תשובות נכונות: ",(0,r.jsx)("span",{className:"text-green-600 font-bold",children:q.length})," מתוך ",F.length," (",Math.round(q.length/F.length*100),"%)"]}),(0,r.jsxs)("p",{className:"text-gray-600 mt-2",children:["זמן שחלף: ",J(S)]}),q.length/F.length<.6&&(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-4",children:[(0,r.jsx)("p",{className:"text-red-700 font-medium",children:"לא ניתן להמשיך למשימה הבאה עם ציון נמוך מ-60%."}),(0,r.jsxs)("p",{className:"text-red-600 text-sm",children:["אתה צריך לענות נכון על לפחות ",Math.ceil(.6*F.length)," שאלות מתוך ",F.length," כדי להמשיך."]})]})]}),(0,r.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,r.jsxs)("div",{className:"bg-green-50 rounded-xl p-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium text-green-800 mb-3",children:["תשובות נכונות (",q.length,")"]}),q.length>0?(0,r.jsx)("ul",{className:"space-y-2",children:q.map((e,t)=>(0,r.jsxs)("li",{className:"flex justify-between items-center bg-white px-4 py-2 rounded-lg shadow-sm",children:[(0,r.jsx)("span",{className:"font-medium",children:e.word}),(0,r.jsx)("span",{className:"text-green-600",children:e.translation})]},"correct-".concat(t)))}):(0,r.jsx)("p",{className:"text-gray-500 text-center py-2",children:"אין תשובות נכונות."})]}),(0,r.jsxs)("div",{className:"bg-red-50 rounded-xl p-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium text-red-800 mb-3",children:["תשובות שגויות (",_.length,")"]}),_.length>0?(0,r.jsx)("ul",{className:"space-y-2",children:_.map((e,t)=>(0,r.jsxs)("li",{className:"flex flex-col bg-white px-4 py-3 rounded-lg shadow-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"font-medium",children:e.word}),(0,r.jsx)("span",{className:"text-red-600 line-through",children:e.userAnswer})]}),(0,r.jsxs)("div",{className:"text-right text-sm mt-1",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"התשובה הנכונה: "}),(0,r.jsx)("span",{className:"text-green-600 font-medium",children:e.translation})]})]},"incorrect-".concat(t)))}):(0,r.jsx)("p",{className:"text-gray-500 text-center py-2",children:"אין תשובות שגויות!"})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("button",{id:"try-again-btn",onClick:()=>{b(0),j(""),y(0),A(0),C(0),E(!0),D(!1),T([]),L([])},className:"w-full py-3 bg-orange-500 text-white rounded-xl hover:bg-orange-600 transition-all duration-300 transform hover:-translate-y-1 shadow-md hover:shadow-xl",children:"נסה שוב \uD83D\uDD04"}),(0,r.jsx)("button",{onClick:()=>{if(v<.6*F.length){let e=document.getElementById("try-again-btn");e&&(e.classList.add("animate-pulse","ring-4","ring-green-300"),setTimeout(()=>{e.classList.remove("animate-pulse","ring-4","ring-green-300")},2e3));return}if(f){sessionStorage.setItem("quiz_task_".concat(u,"_").concat(p),f);try{let e=q.map(e=>e.word);sessionStorage.setItem("quiz_words_".concat(u,"_").concat(p),JSON.stringify(e))}catch(e){console.error("Error storing quiz words:",e)}}let e=new URLSearchParams;e.append("level",p),f&&e.append("quizTaskId",f),m.push("/topics/".concat(u,"/tasks/post?").concat(e.toString()))},disabled:q.length/F.length<.6,className:"w-full py-3 ".concat(q.length/F.length>=.6?"bg-green-500 hover:bg-green-600":"bg-gray-400 cursor-not-allowed"," text-white rounded-xl transition-all duration-300 transform hover:-translate-y-1 shadow-md hover:shadow-xl"),children:"האתגר הבא \uD83C\uDFAF"}),q.length/F.length<.6&&(0,r.jsx)("p",{className:"text-red-600 text-sm mt-2",children:"נדרש לפחות 60% תשובות נכונות כדי להמשיך לאתגר הבא"})]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[473,845,261,47,821,587,315,358],()=>t(7866)),_N_E=e.O()}]);