(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[443],{1820:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var r=s(4568),a=s(7620),o=s(2942);let l=e=>{let{isVisible:t=!1,onClose:s,showIcon:l=!0}=e,[n,i]=(0,a.useState)(t),[c,d]=(0,a.useState)(null),[u,h]=(0,a.useState)(!0);(0,o.useRouter)(),(0,a.useEffect)(()=>{i(t)},[t]),(0,a.useEffect)(()=>{let e=async()=>{if(n){h(!0);try{let e=localStorage.getItem("token");if(!e)throw Error("No authentication token found");let t=await fetch("/api/user-profile",{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("Failed to fetch user profile");let s=await t.json();d({FirstName:s.FirstName||"",LastName:s.LastName||"",Email:s.Email||"",PhoneNumber:s.PhoneNumber||"",EnglishLevel:s.EnglishLevel||"Not Set",AgeRange:s.AgeRange||"",ProfilePicture:s.ProfilePicture||null,CreationDate:new Date(s.CreationDate),LastLogin:s.LastLogin?new Date(s.LastLogin):void 0,Score:s.Score||0}),h(!1)}catch(e){console.error("Error fetching user data:",e),h(!1)}}};n&&e()},[n]);let m=()=>{let e=!n;i(e),!e&&s&&s()};return(0,r.jsxs)(r.Fragment,{children:[l&&(0,r.jsx)("div",{className:"absolute top-4 right-4",children:(0,r.jsx)("div",{className:"w-12 h-12 rounded-full bg-white shadow-lg flex items-center justify-center cursor-pointer hover:shadow-xl transform hover:scale-105 transition-all duration-300",onClick:m,children:(null==c?void 0:c.ProfilePicture)?(0,r.jsx)("img",{src:c.ProfilePicture,alt:"Profile",className:"w-full h-full rounded-full object-cover"}):(0,r.jsx)("span",{className:"text-2xl",children:"\uD83D\uDC64"})})}),n&&(0,r.jsxs)("div",{className:"absolute top-20 right-4 bg-white p-6 shadow-2xl rounded-2xl w-80 z-50 border border-gray-100 transform transition-all duration-300",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-gray-800",children:"User Profile"}),u?(0,r.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,r.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})}):c?(0,r.jsxs)("div",{className:"space-y-3 text-gray-800",children:[c.ProfilePicture&&(0,r.jsx)("div",{className:"flex justify-center mb-4",children:(0,r.jsx)("img",{src:c.ProfilePicture,alt:"Profile",className:"w-24 h-24 rounded-full object-cover border-4 border-gray-200"})}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("p",{className:"flex justify-between",children:[(0,r.jsx)("strong",{children:"Name:"}),(0,r.jsx)("span",{children:(null==c?void 0:c.FirstName)||(null==c?void 0:c.LastName)?"".concat((null==c?void 0:c.FirstName)||""," ").concat((null==c?void 0:c.LastName)||"").trim():"Guest User"})]}),(0,r.jsxs)("p",{className:"flex justify-between",children:[(0,r.jsx)("strong",{children:"Email:"}),(0,r.jsx)("span",{className:"text-right",children:c.Email||"Not provided"})]}),(0,r.jsxs)("p",{className:"flex justify-between",children:[(0,r.jsx)("strong",{children:"Phone:"}),(0,r.jsx)("span",{children:c.PhoneNumber||"Not provided"})]}),(0,r.jsxs)("p",{className:"flex justify-between",children:[(0,r.jsx)("strong",{children:"English Level:"}),(0,r.jsx)("span",{children:c.EnglishLevel})]}),c.AgeRange&&(0,r.jsxs)("p",{className:"flex justify-between",children:[(0,r.jsx)("strong",{children:"Age Range:"}),(0,r.jsx)("span",{children:c.AgeRange})]}),(0,r.jsxs)("p",{className:"flex justify-between",children:[(0,r.jsx)("strong",{children:"Score:"}),(0,r.jsx)("span",{children:c.Score})]}),(0,r.jsxs)("p",{className:"flex justify-between",children:[(0,r.jsx)("strong",{children:"Member Since:"}),(0,r.jsx)("span",{children:c.CreationDate.toLocaleDateString()})]})]})]}):(0,r.jsx)("p",{className:"text-red-500",children:"Failed to load user data"}),(0,r.jsx)("div",{className:"mt-6 space-y-2",children:(0,r.jsx)("button",{className:"w-full py-2 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors",onClick:m,children:"Close"})})]})]})},n=e=>{let{topic:t,userId:s,onError:l}=e,n=(0,o.useRouter)(),[i,c]=(0,a.useState)(!1),d=async e=>{if(e.preventDefault(),!i){c(!0);try{let e=localStorage.getItem("token");if(!e)throw Error("לא נמצא טוקן אימות - יש להתחבר מחדש");let r=t.TopicName.toLowerCase().replace(/\s+/g,"-");console.log("מנסה ליצור משימה: userId=".concat(s,", topicName=").concat(r,", token=").concat(e.slice(0,10),"..."));let a=await fetch("/api/tasks",{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({UserId:s,TopicName:r,Level:"1",TaskType:"flashcard"})});if(!a.ok){console.error("תגובת שגיאה מהשרת:",a.status,a.statusText);let e=await a.json().catch(()=>({error:"שגיאה לא ידועה"}));throw Error(e.error||"שגיאת שרת: ".concat(a.status))}let o=(await a.json()).TaskId;console.log("משימה נוצרה בהצלחה עם מזהה:",o);let l="/topics/".concat(r,"/tasks/flashcard?level=1&taskId=").concat(o);console.log("ניווט אל: ".concat(l)),n.push(l)}catch(e){console.error("שגיאה בבחירת נושא:",e),e instanceof Error&&(e.message.includes("401")||e.message.includes("אימות")||e.message.includes("להתחבר"))&&(console.log("מזהה שגיאת אימות - מנווט לדף התחברות"),n.push("/login")),l&&l(e instanceof Error?e.message:"אירעה שגיאה בהתחלת פעילות. אנא נסה שוב.")}finally{c(!1)}}};return(0,r.jsx)("div",{onClick:d,className:"group bg-white p-6 rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 cursor-pointer",children:(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[i?(0,r.jsx)("div",{className:"w-10 h-10 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"}):(0,r.jsx)("span",{className:"text-4xl group-hover:scale-110 transition-transform duration-300",children:t.Icon||"\uD83C\uDF1F"}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-2 group-hover:text-orange-600 transition-colors",children:t.TopicName}),(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:t.TopicHe})]})]})})};var i=s(9715),c=s(2577),d=s(7261),u=s.n(d);function h(){let[e,t]=(0,a.useState)([]),[s,d]=(0,a.useState)({level:"",points:0,totalScore:0,completedTasks:0,activeSince:"",nextLevel:"",pointsToNextLevel:100}),[h,m]=(0,a.useState)(!1),[x,g]=(0,a.useState)(null),{isAuthenticated:f,isLoading:p,user:j}=(0,i.A)(),N=(0,o.useRouter)();(0,a.useEffect)(()=>{p||f||(console.log("המשתמש אינו מחובר, מעביר לדף התחברות"),N.push("/login"))},[f,p,N]),(0,a.useEffect)(()=>{if(f){let e=async()=>{try{let e=await fetch("/api/user-data",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){let t=await e.json();console.log("User data from API (full response):",t),console.log("Score field specifically:",{score:t.score,Score:t.Score,totalScore:t.totalScore,TotalScore:t.TotalScore,total_score:t.total_score,scoreValue:t.scoreValue}),d({level:t.currentLevel||"Beginner",points:t.currentLevelPoints||0,totalScore:t.score||t.Score||t.totalScore||t.TotalScore||t.total_score||t.scoreValue||0,completedTasks:t.completedTasksCount||0,activeSince:t.CreationDate?new Date(t.CreationDate).toLocaleDateString():"Today",nextLevel:t.nextLevel||"Intermediate",pointsToNextLevel:t.pointsToNextLevel||100})}}catch(e){console.error("Error fetching user data:",e)}};(async()=>{try{let e=await fetch("/api/topics",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){let s=await e.json();t(s)}}catch(e){console.error("Error fetching topics:",e)}})(),e()}},[f]);let v=e=>{g(e),setTimeout(()=>g(null),5e3)};return p?(0,r.jsx)("div",{children:"Loading..."}):f?(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 via-orange-50 to-red-50 p-6 relative",children:[(0,r.jsx)(l,{isVisible:h,onClose:()=>m(!h),showIcon:!0}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-5xl font-bold mb-8 text-center bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent",children:"Choose Your Topic"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-10",children:[(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center mb-2",children:(0,r.jsx)("span",{className:"text-xl",children:"\uD83C\uDFAF"})}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Total Score"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:s.totalScore}),(0,r.jsx)("p",{className:"text-xs text-gray-400",children:"points"})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center mb-2",children:(0,r.jsx)("span",{className:"text-xl",children:"✅"})}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Completed Tasks"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:s.completedTasks}),(0,r.jsx)("p",{className:"text-xs text-gray-400",children:"activities"})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center mb-2",children:(0,r.jsx)("span",{className:"text-xl",children:"⏱️"})}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Active Since"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:s.activeSince})]})]}),(0,r.jsx)("div",{className:"flex justify-center mb-8",children:(0,r.jsx)(u(),{href:"/hall-of-fame",children:(0,r.jsxs)("div",{className:"px-6 py-3 bg-gradient-to-r from-amber-400 to-amber-600 text-white font-semibold rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 flex items-center",children:[(0,r.jsx)("span",{className:"mr-2 text-xl",children:"\uD83D\uDC51"}),(0,r.jsx)("span",{children:"Hall of Fame"})]})})}),x&&(0,r.jsx)("div",{className:"bg-red-100 text-red-700 p-4 rounded-lg mb-6 text-center",children:x}),(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:e.map(e=>(0,r.jsx)(n,{topic:e,userId:(null==j?void 0:j.UserId)||(null==j?void 0:j.userId)||"",onError:v},e.TopicName))})]}),(0,r.jsx)("div",{className:"absolute top-4 left-4 flex space-x-3",children:(0,r.jsx)("button",{onClick:()=>{(0,c.Tp)(),N.push("/login")},className:"w-12 h-12 rounded-full bg-white shadow-lg flex items-center justify-center hover:shadow-xl transform hover:scale-105 transition-all duration-300",children:(0,r.jsx)("span",{className:"text-2xl",children:"\uD83D\uDC4B"})})})]}):null}},2577:(e,t,s)=>{"use strict";async function r(e,t){try{let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),r=await s.json();return{success:s.ok,token:r.token,user:r.user,message:r.message,details:r.details}}catch(e){return console.error("Login service error:",e),{success:!1,message:e instanceof Error?e.message:"An unexpected error occurred"}}}async function a(){try{let e=await fetch("/api/health"),t=await e.json();return{isReachable:"online"===t.status,details:t}}catch(e){return{isReachable:!1,details:e instanceof Error?e.message:"Unknown error"}}}function o(e,t){localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(t)),document.cookie="auth_token=".concat(e,"; path=/; max-age=604800")}function l(){localStorage.removeItem("token"),localStorage.removeItem("user"),document.cookie="auth_token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT"}s.d(t,{Bp:()=>a,Lx:()=>r,NR:()=>o,Tp:()=>l})},2942:(e,t,s)=>{"use strict";var r=s(2418);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},8376:(e,t,s)=>{Promise.resolve().then(s.bind(s,1820))},9715:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var r=s(7620);let a=()=>{let[e,t]=(0,r.useState)({isAuthenticated:!1,isLoading:!0,user:null,error:null});(0,r.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token");if(!e)return t({isAuthenticated:!1,isLoading:!1,user:null,error:null});try{let s=await fetch("/api/auth/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}),r=await s.json();if(r.success){let e=r.user;if(!e){let t=localStorage.getItem("user");t&&(e=JSON.parse(t))}t({isAuthenticated:!0,isLoading:!1,user:e,error:null})}else localStorage.removeItem("token"),localStorage.removeItem("user"),t({isAuthenticated:!1,isLoading:!1,user:null,error:r.message||"Authentication failed"})}catch(e){console.error("Auth validation error:",e),t({isAuthenticated:!1,isLoading:!1,user:null,error:e instanceof Error?e.message:"Authentication error"})}})()},[]);let s=async(e,s)=>{try{t(e=>({...e,isLoading:!0}));let r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:s})}),a=await r.json();if(a.success)return localStorage.setItem("token",a.token),localStorage.setItem("user",JSON.stringify(a.user)),t({isAuthenticated:!0,isLoading:!1,user:a.user,error:null}),{success:!0};return t({isAuthenticated:!1,isLoading:!1,user:null,error:a.message||"Login failed"}),{success:!1,message:a.message||"Login failed"}}catch(s){let e=s instanceof Error?s.message:"An unexpected error occurred";return t({isAuthenticated:!1,isLoading:!1,user:null,error:e}),{success:!1,message:e}}};return{...e,login:s,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),t({isAuthenticated:!1,isLoading:!1,user:null,error:null})}}}}},e=>{var t=t=>e(e.s=t);e.O(0,[261,587,315,358],()=>t(8376)),_N_E=e.O()}]);