(()=>{var e={};e.id=255,e.ids=[255],e.modules={2436:(e,t,r)=>{Promise.resolve().then(r.bind(r,15391))},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14276:()=>{},15391:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(33952).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/amitnachman/Desktop/280425/apps/web/src/app/topics/[topicName]/tasks/conversation/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/amitnachman/Desktop/280425/apps/web/src/app/topics/[topicName]/tasks/conversation/page.tsx","default")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},20685:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n,metadata:()=>o});var s=r(38828);r(14276);let o={title:"Unity Voice",description:"Unity Voice app"};function n({children:e}){return(0,s.jsx)("html",{lang:"en",children:(0,s.jsx)("body",{className:"antialiased",children:e})})}},20768:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var s=r(55511);let o={randomUUID:s.randomUUID},n=new Uint8Array(256),a=n.length,i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));let l=function(e,t,r){if(o.randomUUID&&!t&&!e)return o.randomUUID();let l=(e=e||{}).random??e.rng?.()??(a>n.length-16&&((0,s.randomFillSync)(n),a=0),n.slice(a,a+=16));if(l.length<16)throw Error("Random bytes length must be >= 16");if(l[6]=15&l[6]|64,l[8]=63&l[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=l[e];return t}return function(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}(l)}},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34935:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,69355,23)),Promise.resolve().then(r.t.bind(r,54439,23)),Promise.resolve().then(r.t.bind(r,67851,23)),Promise.resolve().then(r.t.bind(r,94730,23)),Promise.resolve().then(r.t.bind(r,19774,23)),Promise.resolve().then(r.t.bind(r,53170,23)),Promise.resolve().then(r.t.bind(r,20968,23)),Promise.resolve().then(r.t.bind(r,78298,23))},38504:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55588:(e,t,r)=>{Promise.resolve().then(r.bind(r,73913))},58369:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var s=r(60159);let o=()=>{let[e,t]=(0,s.useState)({isAuthenticated:!1,isLoading:!0,user:null,error:null});(0,s.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token");if(!e)return t({isAuthenticated:!1,isLoading:!1,user:null,error:null});try{let r=await fetch("/api/auth/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}),s=await r.json();if(s.success){let e=s.user;if(!e){let t=localStorage.getItem("user");t&&(e=JSON.parse(t))}t({isAuthenticated:!0,isLoading:!1,user:e,error:null})}else localStorage.removeItem("token"),localStorage.removeItem("user"),t({isAuthenticated:!1,isLoading:!1,user:null,error:s.message||"Authentication failed"})}catch(e){console.error("Auth validation error:",e),t({isAuthenticated:!1,isLoading:!1,user:null,error:e instanceof Error?e.message:"Authentication error"})}})()},[]);let r=async(e,r)=>{try{t(e=>({...e,isLoading:!0}));let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r})}),o=await s.json();if(o.success)return localStorage.setItem("token",o.token),localStorage.setItem("user",JSON.stringify(o.user)),t({isAuthenticated:!0,isLoading:!1,user:o.user,error:null}),{success:!0};return t({isAuthenticated:!1,isLoading:!1,user:null,error:o.message||"Login failed"}),{success:!1,message:o.message||"Login failed"}}catch(r){let e=r instanceof Error?r.message:"An unexpected error occurred";return t({isAuthenticated:!1,isLoading:!1,user:null,error:e}),{success:!1,message:e}}};return{...e,login:r,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),t({isAuthenticated:!1,isLoading:!1,user:null,error:null})}}}},62959:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,30385,23)),Promise.resolve().then(r.t.bind(r,33737,23)),Promise.resolve().then(r.t.bind(r,86081,23)),Promise.resolve().then(r.t.bind(r,1904,23)),Promise.resolve().then(r.t.bind(r,35856,23)),Promise.resolve().then(r.t.bind(r,55492,23)),Promise.resolve().then(r.t.bind(r,89082,23)),Promise.resolve().then(r.t.bind(r,45812,23))},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},70173:(e,t,r)=>{"use strict";function s(){return null}r.d(t,{c4:()=>s}),r(32970)},73913:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var s=r(13486),o=r(20768),n=r(60159),a=r(49989),i=r.n(a),l=r(2984),c=r(70173),d=r(58369);function u(){(0,l.useRouter)();let e=(0,l.useParams)(),t=(0,l.useSearchParams)(),r=e?.topicName,a=t?.get("level")||"1",u=t?.get("taskId"),{isAuthenticated:h,isLoading:m,user:p}=(0,d.A)(),[g,x]=(0,n.useState)(!1),[f,y]=(0,n.useState)([]),[b,v]=(0,n.useState)(!0),[w,j]=(0,n.useState)([]),[S,k]=(0,n.useState)(""),[N,I]=(0,n.useState)([]),[P,T]=(0,n.useState)({messagesExchanged:0,correctWords:0,averageScore:0,totalScore:0}),[A,C]=(0,n.useState)(null),[E,$]=(0,n.useState)(!1),[q,U]=(0,n.useState)(!1),[D,L]=(0,n.useState)(!1),[O,M]=(0,n.useState)(!1),[R,_]=(0,n.useState)([]),[W,J]=(0,n.useState)(null),[Q,z]=(0,n.useState)(null),[B,F]=(0,n.useState)(0),Y=(0,n.useRef)(null),G=(0,n.useRef)(null),V=(0,n.useRef)(null),H=(0,n.useRef)(null),K=(0,n.useRef)(null),X=(0,n.useRef)(null),Z=(0,n.useRef)(null),ee=(0,n.useRef)(null);(0,n.useRef)(null);let[et,er]=(0,n.useState)([]),[es,eo]=(0,n.useState)(""),en=e=>e.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),ea=e=>{if(!e)return"";let t=e;return N.forEach(e=>{if(!e)return;let r=RegExp(`\\b${e}\\b`,"gi");t=t.replace(r,'<span class="font-bold text-orange-600">$&</span>')}),t},ei=()=>{if(Y.current)try{console.log("Activating microphone"),Y.current.start(),y(e=>{let t=e[e.length-1];return t&&"ai"===t.type&&t.content.includes("Microphone is active")?e:[...e,{type:"ai",content:"\uD83C\uDFA4 Microphone is active. Please speak now.",feedback:"Your turn to speak"}]}),H.current&&clearTimeout(H.current),H.current=window.setTimeout(()=>{if(O&&!D){try{Y.current?.stop(),M(!1)}catch(e){console.log("Error stopping recognition on timeout",e)}let e="I didn't hear your response. Let's move on to the next question.";y(t=>[...t,{type:"ai",content:e}]),_(t=>[...t,e,"Let's try again. "+ed()])}},2e4)}catch(e){console.error("Could not start speech recognition:",e),y(e=>[...e,{type:"ai",content:"I'm having trouble with the microphone. Please try refreshing the page.",feedback:"Microphone error"}])}},el=(e,t)=>{if(!G.current)return;if(q&&X.current){console.log("Already speaking, not starting new utterance"),t&&setTimeout(t,500);return}if(U(!0),G.current.cancel(),Y.current)try{Y.current.stop()}catch(e){console.log("Error stopping recognition during AI speech",e)}ee.current=Date.now();let r=Date.now().toString();console.log(`Starting speech ID: ${r} with text length: ${e.length}`);let s=((e=>{let t=e.match(/[^\.!\?]+[\.!\?]+|\s*$/g)||[],r=[],s=new Set;return t.forEach(e=>{let t=e.trim();if(t.length>0){let e=t.toLowerCase().replace(/\s+/g," ");s.has(e)||(s.add(e),r.push(t))}}),r.join(" ")})(e).match(/[^\.!\?]+[\.!\?]+|\s*$/g)||[]).filter(e=>e.trim().length>0);if(0===s.length){console.log("No speech chunks to process"),U(!1),t&&setTimeout(t,100);return}let o=0,n=()=>{if(o>=s.length){console.log(`Speech ID: ${r} completed`),U(!1),X.current=null,t&&setTimeout(t,300);return}let e=new SpeechSynthesisUtterance(s[o]),a=G.current?.getVoices()||[],i=a.find(e=>e.name===es)||a.find(e=>"en-US"===e.lang);i&&(e.voice=i,console.log(`Using voice: ${i.name}`)),e.lang="en-US",e.rate=1,e.pitch=1.1,e.onend=()=>{o++,n()},e.onerror=e=>{console.error(`Speech error in chunk ${o}:`,e),o++,n()},X.current=e,G.current&&G.current.speak(e)};n();let a=setTimeout(()=>{q&&(console.log(`Speech watchdog triggered for speech ID: ${r}`),U(!1),G.current&&G.current.cancel(),t&&t())},3e4);return()=>clearTimeout(a)},ec=async()=>{x(!0),y([]),U(!1),L(!1),M(!1),_([]),T({messagesExchanged:0,correctWords:0,averageScore:0,totalScore:0});try{let e=await eg();if(!e){C("Failed to create conversation session"),x(!1);return}J(e),console.log(`Setting sessionId state to: ${e}`);let t=`Welcome to our conversation about ${en(r)}! Let's practice English together.`;y([{type:"ai",content:t}]);let s=ed();_([t,s]);let n=async()=>{try{if(!e)return console.error("Cannot record first question: sessionId not available"),null;console.log(`Recording first question using direct sessionId: ${e}`);let t=async(e,t)=>{if(!t)return console.error("Cannot record question: missing sessionId parameter"),null;let r=(0,o.A)();z(r),F(e=>e+1);try{let s=(0,c.c4)();if(!s)return console.warn("No authentication token available for question recording"),r;let o=e.length>1e3?e.substring(0,997)+"...":e;console.log(`Recording question for session ${t}:`,o.substring(0,30)+"...");try{let e=await fetch("/api/question",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({QuestionId:r,SessionId:t,QuestionText:o}),signal:AbortSignal.timeout(8e3)});if(!e.ok){let t="Failed to record question";try{t=(await e.json()).error||t}catch(r){t=await e.text()||t}return console.error(`Question recording failed: ${t}`),r}let n=await e.json();return console.log("Question recorded successfully:",n),r}catch(e){return console.error("Error recording question:",e),r}}catch(e){return console.error("Error in recordQuestion:",e),r}},r=await t(s,e);console.log("Recorded first question with ID:",r),y(e=>[...e,{type:"ai",content:s}])}catch(e){console.error("Error recording first question:",e),y(e=>[...e,{type:"ai",content:s}])}};setTimeout(n,500)}catch(e){console.error("Error in startConversation:",e),C("Failed to start conversation. Please try again."),x(!1)}},ed=()=>{let e=r.toLowerCase();if(e.includes("diplomacy"))return"What do you think about Israel's diplomatic relations with other countries?";if(e.includes("economy"))return"What interests you about Israel's economy or startup ecosystem?";if(e.includes("innovation"))return"What Israeli technological innovations are you familiar with?";if(e.includes("history"))return"What aspects of Israeli history do you find most interesting?";if(e.includes("holocaust"))return"Why do you think it's important to remember historical events like the Holocaust?";else if(e.includes("iron")||e.includes("sword"))return"What are your thoughts on how countries should protect their citizens?";else if(e.includes("environment"))return"What do you think about Israel's focus on renewable energy to protect the environment?";else if(e.includes("society"))return"What do you think is the most important action individuals can take to help protect the environment?";else return`What aspects of ${en(r)} interest you the most?`},eu=()=>{if(M(!1),Y.current)try{Y.current.stop()}catch(e){console.log("Error stopping recognition",e)}G.current&&G.current.cancel(),U(!1),H.current&&(clearTimeout(H.current),H.current=null),K.current&&(clearTimeout(K.current),K.current=null)},eh=async()=>{x(!1),M(!1),y(e=>[...e,{type:"ai",content:"Saving your progress...",feedback:"Please wait while we update your level."}]);try{eu();let e=P.totalScore;if(e<=0&&P.messagesExchanged>0&&(e=Math.round(P.correctWords/P.messagesExchanged*100)),e=Math.max(60,e),await em(),u){let t=sessionStorage.getItem(`task_start_${u}`),r=0;t&&(r=Math.floor((Date.now()-parseInt(t))/1e3));let s=(0,c.c4)();s&&await fetch("/api/tasks",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({taskId:u,TaskScore:e,DurationTask:r,CompletionDate:new Date().toISOString(),SessionId:W,QuestionsCount:B,MessagesExchanged:P.messagesExchanged})})}window.location.href="/topics"}catch(e){console.error("Error in stopConversation:",e)}},em=async()=>{if(!u||!r||!a)throw console.error("Missing required information to update user level"),Error("Missing required data");let e=(0,c.c4)();if(!e)throw Error("Authentication required");let t=P.totalScore;t<=0&&P.messagesExchanged>0&&(t=Math.round(P.correctWords/P.messagesExchanged*100)),t=Math.max(t,60);let s=r.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),o=await fetch("/api/user-level/update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({topicName:s,currentLevel:parseInt(a),earnedScore:t,taskId:u,isCompleted:!0})});return{...JSON.parse(await o.text()),success:!0}},ep=async()=>{if(!E&&u)try{$(!0),eu();let e=(0,c.c4)();if(!e)throw Error("Authentication required");let t="Great job! You've completed the conversation practice.",s=`Your average score: ${P.averageScore}/100`;y(e=>[...e,{type:"ai",content:t,feedback:s}]),W&&await ex(t),el(t+" "+s,()=>{setTimeout(()=>{console.log("Redirecting to topics page..."),window.location.href="/topics"},2e3)});let o=sessionStorage.getItem(`task_start_${u}`),n=0;o&&(n=Math.floor((Date.now()-parseInt(o))/1e3)),console.log(`Marking task ${u} as completed with score ${P.averageScore} and duration ${n}s`);try{let t=await fetch("/api/tasks",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({taskId:u,TaskScore:P.averageScore||60,DurationTask:n,CompletionDate:new Date().toISOString(),SessionId:W,QuestionsCount:B,MessagesExchanged:P.messagesExchanged})});if(t.ok){let e=await t.json();console.log("Task completion result:",e)}else console.error(`Failed to complete task: ${await t.text()}`)}catch(e){console.error("Error completing task:",e)}try{console.log("Updating user level...");let t=r.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),s=await fetch("/api/user-level/update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({topicName:t,currentLevel:parseInt(a||"1"),earnedScore:P.averageScore||60,taskId:u,isCompleted:!0})});if(!s.ok){let e=await s.text();throw console.error(`Level update failed: ${e}`),Error("Failed to update user level")}let o=await s.json();console.log("User level update result:",o)}catch(e){console.error("Error updating user level:",e)}let i="Task completed! You can now return to topics or try another activity.";y(e=>[...e,{type:"ai",content:i,feedback:"✅ Task completion recorded"}]),el(i,()=>{setTimeout(()=>{console.log("Redirecting to topics page..."),window.location.href="/topics"},2e3)})}catch(t){console.error("Error completing task:",t);let e="There was an issue saving your progress. Please try again.";y(t=>[...t,{type:"ai",content:e,feedback:"Error completing task"}]),el(e,()=>{})}finally{$(!1)}},eg=async()=>{if(!u)return console.error("Cannot create session: missing taskId"),null;let e=(0,o.A)();Z.current=e,J(e);try{let t=(0,c.c4)();if(!t)return console.warn("No authentication token available for session creation"),e;console.log(`Creating interactive session for task ${u}`);try{let r=await fetch("/api/interactive-session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({SessionId:e,taskId:u,sessionType:"conversation"}),signal:AbortSignal.timeout(8e3)});if(!r.ok){let t="Failed to create interactive session";try{t=(await r.json()).error||t}catch(e){t=await r.text()||t}return console.error(`Interactive session creation failed: ${t}`),e}let s=await r.json();if(console.log("Interactive session created:",s),s.SessionId&&s.SessionId!==e)return Z.current=s.SessionId,J(s.SessionId),s.SessionId;return e}catch(t){return console.error("Error creating interactive session:",t),e}}catch(t){return console.error("Error in createInteractiveSession:",t),e}},ex=async e=>{let t=Z.current||W;if(!t)return console.error("Cannot record question: missing sessionId (checked both ref and state)"),null;let r=(0,o.A)();z(r),F(e=>e+1);try{let s=(0,c.c4)();if(!s)return console.warn("No authentication token available for question recording"),r;let o=e.length>1e3?e.substring(0,997)+"...":e;console.log(`Recording question for session ${t}:`,o.substring(0,30)+"...");try{let e=await fetch("/api/question",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({QuestionId:r,SessionId:t,QuestionText:o}),signal:AbortSignal.timeout(8e3)});if(!e.ok){let t="Failed to record question";try{t=(await e.json()).error||t}catch(r){t=await e.text()||t}return console.error(`Question recording failed: ${t}`),r}let n=await e.json();return console.log("Question recorded successfully:",n),r}catch(e){return console.error("Error recording question:",e),r}}catch(e){return console.error("Error in recordQuestion:",e),r}};return m||b?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 via-orange-50 to-red-50 p-6 flex justify-center items-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"inline-block w-16 h-16 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,s.jsx)("p",{className:"text-xl font-medium text-gray-700",children:"Loading conversation..."})]})}):A?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 via-orange-50 to-red-50 p-6 flex justify-center items-center",children:(0,s.jsxs)("div",{className:"max-w-md w-full bg-white p-8 rounded-2xl shadow-xl text-center",children:[(0,s.jsx)("div",{className:"text-red-500 text-5xl mb-4",children:"❌"}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:A}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"We couldn't load the conversation at this time. Please try again later."}),(0,s.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-orange-500 text-white rounded-xl hover:bg-orange-600 transition-all duration-300",children:"Try Again"}),(0,s.jsx)(i(),{href:"#",className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-all duration-300",children:"Back to Topics"})]})]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 via-orange-50 to-red-50 p-6 relative",children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold text-center text-gray-800 mb-6 mt-2",children:[en(r)," - Conversation Practice"]}),(0,s.jsxs)("div",{className:"max-w-4xl mx-auto mt-4",children:[!g&&(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 mb-8 text-center",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Conversation Practice"}),(0,s.jsxs)("p",{className:"text-gray-600 mb-6",children:["Practice speaking English about ",(0,s.jsx)("span",{className:"font-bold",children:en(r)}),". Our AI conversation partner will listen to you, provide feedback, and help you improve your speaking skills."]}),N.length>0&&(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-700 mb-3",children:"Try to use these words:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 justify-center",children:N.map((e,t)=>(0,s.jsx)("span",{className:"px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm",children:e},t))})]}),(0,s.jsx)("button",{onClick:ec,className:"px-8 py-4 bg-orange-500 text-white text-xl font-bold rounded-full hover:bg-orange-600 transition-colors shadow-lg",children:"Start Conversation"})]}),g&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("button",{onClick:eh,className:"px-6 py-3 bg-red-500 text-white font-bold rounded-xl hover:bg-red-600 transition-colors shadow-lg",children:"End Conversation"}),P.messagesExchanged>=3&&(0,s.jsx)("button",{onClick:ep,disabled:E,className:"px-6 py-3 bg-green-500 text-white font-bold rounded-xl hover:bg-green-600 transition-colors shadow-lg disabled:opacity-50",children:E?"Completing...":"Complete Task"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-xl ${q?"bg-green-100 animate-pulse":O?"bg-red-100 animate-pulse":"bg-orange-100"}`,children:q?"\uD83D\uDD0A":O?"\uD83C\uDF99️":"\uD83D\uDCAC"}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"AI Conversation Partner"}),(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:q?"AI is speaking... Please listen":O?"Your turn to speak - Microphone active":g?"Processing...":"Click Start to begin"})]})]}),P.messagesExchanged>0&&(0,s.jsxs)("div",{className:"bg-gray-100 px-4 py-2 rounded-lg",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Your score"}),(0,s.jsxs)("div",{className:"text-2xl font-bold text-orange-600",children:[P.averageScore,"/100"]})]})]}),(0,s.jsxs)("div",{className:"space-y-4 max-h-[400px] overflow-y-auto mb-4",children:[f.map((e,t)=>(0,s.jsxs)("div",{className:`p-4 rounded-lg ${"user"===e.type?"bg-orange-100 ml-12":e.content.includes("Microphone is active")?"bg-red-50 border border-red-200":"bg-gray-100 mr-12"}`,children:["ai"===e.type&&e.content.includes("Microphone is active")?(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-6 h-6 bg-red-500 rounded-full animate-pulse mr-2"}),(0,s.jsx)("p",{className:"text-gray-800 font-medium",children:e.content})]}):(0,s.jsx)("p",{className:"text-gray-800",dangerouslySetInnerHTML:{__html:"ai"===e.type?ea(e.content):e.content}}),e.feedback&&(0,s.jsx)("p",{className:"mt-2 text-sm text-orange-600 italic",children:e.feedback}),void 0!==e.score&&(0,s.jsxs)("div",{className:"mt-2 flex items-center",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500 mr-2",children:"Score:"}),(0,s.jsxs)("span",{className:`text-sm font-medium ${e.score>=80?"text-green-600":e.score>=60?"text-orange-600":"text-red-600"}`,children:[e.score,"/100"]})]})]},t)),(0,s.jsx)("div",{ref:V})]}),(0,s.jsxs)("div",{className:"mt-4 bg-gray-50 p-3 rounded-lg border border-gray-200",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Conversation Status:"}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-4 justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:`w-3 h-3 rounded-full mr-2 ${q?"bg-green-500 animate-pulse":"bg-gray-300"}`}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"AI Speaking"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:`w-3 h-3 rounded-full mr-2 ${O?"bg-red-500 animate-pulse":"bg-gray-300"}`}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Your Turn to Speak"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:`w-3 h-3 rounded-full mr-2 ${D?"bg-orange-500 animate-pulse":"bg-gray-300"}`}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Speech Detected"})]})]})]}),q&&(0,s.jsx)("div",{className:"mt-4 flex justify-center",children:(0,s.jsx)("button",{onClick:()=>{G.current&&G.current.cancel(),U(!1),X.current=null,y(e=>[...e,{type:"ai",content:"Speech skipped. Your turn to speak.",feedback:"Manual skip"}]),setTimeout(()=>{M(!0),ei()},500)},className:"px-4 py-2 bg-blue-500 text-white font-medium rounded-lg hover:bg-blue-600 transition-colors shadow-md",children:"Skip AI Speech"})}),g&&(0,s.jsxs)("div",{className:"mt-4 bg-gray-50 p-3 rounded-lg border border-gray-200",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Voice Settings:"}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 mr-2",children:"Voice:"}),(0,s.jsx)("select",{value:es,onChange:e=>eo(e.target.value),className:"px-2 py-1 border border-gray-300 rounded text-sm",children:et.map(e=>(0,s.jsx)("option",{value:e.name,children:e.name},e.name))})]})]})]}),N.length>0&&(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"Try to use these words:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:N.map((e,t)=>(0,s.jsx)("span",{className:"px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm",children:e},t))})]})]})]})]})}AbortSignal.timeout||(AbortSignal.timeout=function(e){let t=new AbortController;return setTimeout(()=>t.abort(new DOMException("TimeoutError","TimeoutError")),e),t.signal})},74952:()=>{},76501:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>a.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>c});var s=r(24332),o=r(48819),n=r(67851),a=r.n(n),i=r(97540),l={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);r.d(t,l);let c={children:["",{children:["topics",{children:["[topicName]",{children:["tasks",{children:["conversation",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,15391)),"/Users/amitnachman/Desktop/280425/apps/web/src/app/topics/[topicName]/tasks/conversation/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,97814)),"/Users/amitnachman/Desktop/280425/apps/web/src/app/topics/[topicName]/tasks/layout.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,20685)),"/Users/amitnachman/Desktop/280425/apps/web/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,19033,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,39956,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,92341,23)),"next/dist/client/components/unauthorized-error"]}]}.children,d=["/Users/amitnachman/Desktop/280425/apps/web/src/app/topics/[topicName]/tasks/conversation/page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:o.RouteKind.APP_PAGE,page:"/topics/[topicName]/tasks/conversation/page",pathname:"/topics/[topicName]/tasks/conversation",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},79428:e=>{"use strict";e.exports=require("buffer")},80408:()=>{},87032:()=>{},97814:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var s=r(38828);function o({children:e}){return(0,s.jsx)("html",{lang:"en",children:(0,s.jsx)("body",{children:e})})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[191,787,989,843],()=>r(76501));module.exports=s})();